<?php
session_start();

// Initialize or reset the game
if (!isset($_SESSION['board']) || isset($_GET['reset'])) {
    $_SESSION['board'] = array_fill(0, 9, '');
    $_SESSION['turn'] = 'X'; // Start with player X
    $_SESSION['winner'] = null;
}

// Handle the player's move
if (isset($_GET['move']) && $_SESSION['winner'] === null) {
    $position = $_GET['move'];
    
    // If the selected cell is empty, mark it
    if ($_SESSION['board'][$position] == '') {
        $_SESSION['board'][$position] = $_SESSION['turn'];
        
        // Check if there's a winner
        checkWinner();
        
        // Switch turn to the other player
        $_SESSION['turn'] = ($_SESSION['turn'] === 'X') ? 'O' : 'X';
    }
}

// Function to check for a winner
function checkWinner() {
    $winning_combinations = [
        [0, 1, 2], [3, 4, 5], [6, 7, 8], // Rows
        [0, 3, 6], [1, 4, 7], [2, 5, 8], // Columns
        [0, 4, 8], [2, 4, 6]             // Diagonals
    ];
    
    foreach ($winning_combinations as $combo) {
        if ($_SESSION['board'][$combo[0]] != '' &&
            $_SESSION['board'][$combo[0]] == $_SESSION['board'][$combo[1]] &&
            $_SESSION['board'][$combo[1]] == $_SESSION['board'][$combo[2]]) {
            $_SESSION['winner'] = $_SESSION['board'][$combo[0]];
            return;
        }
    }
    
    // Check for a tie
    if (!in_array('', $_SESSION['board'])) {
        $_SESSION['winner'] = 'Tie';
    }
}
?>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Tic-Tac-Toe Game</title>
    <style>
        .grid { display: grid; grid-template-columns: repeat(3, 100px); gap: 5px; }
        .cell { width: 100px; height: 100px; font-size: 24px; text-align: center; }
        .winner { font-weight: bold; margin-top: 20px; }
    </style>
</head>
<body>
    <h1>Tic-Tac-Toe</h1>

    <div class="grid">
        <?php for ($i = 0; $i < 9; $i++): ?>
            <form method="GET" style="display:inline;">
                <button class="cell" name="move" value="<?php echo $i; ?>" 
                        <?php echo ($_SESSION['board'][$i] != '' || $_SESSION['winner'] !== null) ? 'disabled' : ''; ?>>
                    <?php echo $_SESSION['board'][$i]; ?>
                </button>
            </form>
        <?php endfor; ?>
    </div>

    <?php if ($_SESSION['winner'] !== null): ?>
        <div class="winner">
            <?php
                if ($_SESSION['winner'] === 'Tie') {
                    echo "It's a tie!";
                } else {
                    echo "Player " . $_SESSION['winner'] . " wins!";
                }
            ?>
        </div>
        <a href="?reset=true">Play Again</a>
    <?php endif; ?>
</body>
</html>
